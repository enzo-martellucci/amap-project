<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>My Orders</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
<div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-6" th:text="${producerName}"></h1>

    <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-semibold mb-4">Orders Received</h2>

        <div class="text-gray-500" th:if="${orders.isEmpty()}">
            No orders yet.
        </div>

        <div th:unless="${orders.isEmpty()}">
            <div class="border-b py-4 last:border-b-0" th:each="order : ${orders}">
                <div class="flex justify-between items-start mb-2">
                    <div>
                        <p class="font-semibold">Order #<span th:text="${order.id}"></span></p>
                        <p class="text-sm text-gray-600" th:text="${#temporals.format(order.date, 'dd/MM/yyyy HH:mm')}"></p>
                    </div>
                    <span class="px-3 py-1 rounded text-sm font-semibold"
                          th:classappend="${order.status.name() == 'PENDING' ? 'bg-yellow-200 text-yellow-800' :
                                             (order.status.name() == 'ACCEPTED' ? 'bg-green-200 text-green-800' :
                                             (order.status.name() == 'REJECTED' ? 'bg-red-200 text-red-800' : 'bg-gray-200 text-gray-800'))}"
                          th:text="${order.status.displayName}"></span>
                </div>

                <div class="mt-2">
                    <p class="font-semibold mb-1">Products:</p>
                    <ul class="list-disc list-inside">
                        <li class="text-sm" th:each="item : ${order.products}">
                            <span th:text="${item.name}"></span> -
                            <span th:text="${item.quantity}"></span> x
                            <span th:text="${item.unitPrice} + '€'"></span>
                        </li>
                    </ul>
                </div>

                <p class="mt-2 font-bold">Total: <span th:text="${order.total} + '€'"></span></p>

                <!-- Action buttons for PENDING orders -->
                <div class="mt-3 flex gap-2" th:if="${order.status.name() == 'PENDING'}">
                    <form method="post" style="display:inline;" th:action="@{/orders/accept/{id}(id=${order.id})}">
                        <button class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600" type="submit">
                            Accept Order
                        </button>
                    </form>
                    <form method="post" style="display:inline;" th:action="@{/orders/reject/{id}(id=${order.id})}">
                        <button class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600" type="submit">
                            Reject Order
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-4">
        <a class="text-blue-500 hover:underline" href="/products">Back to Products</a>
    </div>
</div>
</body>
</html>